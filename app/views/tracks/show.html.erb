<% if can? :update, @track %>
  <%= render partial: "tour_link", locals: {tour_name: "tour_track_show_update"} %>
<% else %>
  <%= render partial: "tour_link", locals: {tour_name: "tour_track_show"} %>
<% end %>

<div class="row">
  <div class="small-12 medium-10 medium-centered columns">
    <div class="transpanel">
      <h3 class="track-name">
        <%= best_in_place_if can?(:update, @track), @track, :name,
          {ok_button: 'save', cancel_button: 'cancel'} %>
        <span class="label genome">
          <%= best_in_place_if can?(:update, @track), @track, :genome,
            {ok_button: 'save', cancel_button: 'cancel'} %>
        </span>
      </h3>

      <ul class="small-block-grid-2">
        <li>
          <div class="owner-icon icon-key"><%= can?(:manage, @track) ? link_to(@track.owner.handle, @track.owner) : @track.owner.handle %></div>
          <div>in project <%= link_to @track.project.name, @track.project %></div>
        </li>

        <li>
          <%= render partial: 'timestamps', locals: { record: @track } %>
        </li>
      </ul>

      <div>
        <ul class="inline-list" id="track-download-links">
          <li>
            <%= link_to_igv(@track) %>
          </li>
          <li>
            <%= link_to "igv (embedded)", "#", class: 'igv-js-link' %>
          </li>
          <% if Pathname.new(@track.path).extname == ".bam" %>
            <li><%= link_to "download bam file", stream_services_track_path(@track), class: 'fi-download icon-key' %></li>
            <li><%= link_to "download bai file", stream_services_track_path(@track, format: 'bai'), class: 'fi-download icon-key' %></li>
            <% elsif Pathname.new(@track.path).extname == ".bw" %>
            <li><%= link_to "download bw file", stream_services_track_path(@track), class: 'fi-download icon-key' %></li>
          <% end %>
        </ul>
      </div>

      <div>
        <h5>Server path</h5>
        <p class="clipboard-box" id="track-server-path">
          <i class="fi-clipboard copy-to-clipboard pointer" data-clipboard-id="clip_track_path"></i>
          <span id="clip_track_path"><%= @track.full_path %></span>
        </p>
      </div>

      <div class="share-track">
        <h5 class="no-margin-bottom" id="track-share-links">Track share links</h5>
        <span class="subhead-note">
          Manage shared passwordless access to tracks for outside collaborators and the UCSC browser
        </span>
        <p class="medium-margin-top" id="create-share-links">
          <%= link_to "Create new share link", new_share_link_path(share_link: { track_id: @track.id}), id: "new_link", class: "big-margin-right", remote: true %>
          <% if @track.share_links.any? {|f| f.expired?} %>
            <%= link_to "show expired links", "#", class: "show-expired-share-links" %>
          <% end %>
        </p>

        <div id="share-links-list">
          <% if @track.share_links.any? %>
            <%= render @track.share_links.order(:expires_at) %>
          <% else %>
            <p id="no-share-link">There are no track line links for this track</p>
          <% end %>
        </div>
      </div>

      <div class="igv-js" data-igv-url=<%= stream_services_track_path(@track) %> data-tracks-user-id=<%= @tracks_user.id %> data-track-locus=<%= @tracks_user.locus %>>
      </div>

    </div>
    <%= link_to 'Back', :back, class: 'button tiny radius' %>
    <% if can? :destroy, @track %>
      <%= link_to 'Delete', @track, method: :delete, data: { confirm: 'Are you sure? Clicking this button will permanently delete this track' }, class: 'button tiny radius [secondary alert success] right', id: "delete-track" %>
    <% end %>
  </div>
</div>
